<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Le Mot-Cross - GCSE French Revision</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation; /* Improves touch response */
        }

        /* Flip Animation */
        .flip-card {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .flip-in {
            animation: flipIn 0.5s ease-in forwards;
        }
        
        @keyframes flipIn {
            0% { transform: rotateX(0); }
            50% { transform: rotateX(-90deg); }
            100% { transform: rotateX(0); }
        }

        /* Shake Animation for errors */
        .shake {
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
            20%, 40%, 60%, 80% { transform: translateX(4px); }
        }

        /* Custom Scrollbar for the grid container */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col items-center overflow-hidden">

    <!-- HEADER -->
    <header class="w-full bg-indigo-600 text-white p-2 md:p-4 shadow-md flex justify-between items-center z-10 shrink-0">
        <div class="flex items-center gap-2">
            <!-- Icon: Book/Cross -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="md:w-6 md:h-6"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
            <h1 class="text-base md:text-2xl font-bold tracking-wider">LE MOT-CROSS</h1>
        </div>
        <button id="restartBtn" class="p-2 hover:bg-indigo-700 rounded-full transition-colors" title="New Game">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="md:w-5 md:h-5"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>
        </button>
    </header>

    <!-- MAIN GAME AREA -->
    <main class="flex-1 w-full max-w-2xl p-2 flex flex-col items-center relative overflow-hidden min-h-0">
        
        <!-- CLUE BOX -->
        <div class="w-full max-w-lg bg-white p-2 md:p-4 rounded-lg shadow-sm border border-slate-200 mb-2 text-center relative overflow-hidden shrink-0">
            <div id="lengthBadge" class="absolute top-0 right-0 bg-indigo-100 text-indigo-700 text-[10px] md:text-xs font-bold px-2 py-1 rounded-bl">
                5 Letters
            </div>
            <span class="block text-[10px] md:text-xs uppercase text-slate-400 font-bold mb-1">English Clue</span>
            <h2 id="clueText" class="text-base md:text-2xl font-bold text-indigo-900 break-words leading-tight">
                Loading...
            </h2>
        </div>

        <!-- MESSAGE TOAST -->
        <div id="toastContainer" class="h-6 md:h-8 mb-1 flex items-center justify-center shrink-0">
            <div id="toast" class="hidden px-4 py-1 rounded-full text-xs md:text-sm font-bold bg-slate-800 text-white transition-opacity duration-300"></div>
        </div>

        <!-- GRID CONTAINER -->
        <div id="gridContainer" class="w-full flex-1 overflow-y-auto no-scrollbar flex flex-col items-center px-1 pb-2">
            <!-- Grid rows generated by JS -->
        </div>

        <!-- MODAL (Win/Loss) -->
        <div id="resultModal" class="hidden absolute inset-0 z-20 bg-slate-50/90 flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in duration-300">
            <div class="bg-white p-6 md:p-8 rounded-2xl shadow-2xl border border-slate-100 text-center max-w-sm w-full transform scale-100">
                <div id="resultIcon" class="flex justify-center mb-3"></div>
                <h3 id="resultTitle" class="text-2xl md:text-3xl font-bold text-slate-800 mb-2"></h3>
                <p class="text-slate-500 text-sm uppercase font-bold tracking-wide mb-1">The answer was</p>
                <p id="resultWord" class="text-xl md:text-3xl font-bold text-indigo-600 mb-6"></p>
                <button id="modalRestartBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 md:py-4 px-6 rounded-xl shadow-lg shadow-indigo-200 transition-all transform hover:-translate-y-1">
                    Play Again (Jouer Encore)
                </button>
            </div>
        </div>

    </main>

    <!-- KEYBOARD AREA -->
    <div class="w-full max-w-2xl p-1 bg-white border-t border-slate-200 shrink-0 safe-area-bottom">
        
        <!-- Utility Bar -->
        <div class="flex justify-between items-center px-2 mb-1">
            <div id="guessCounter" class="text-[10px] md:text-xs text-slate-400 font-medium">0 / 6 Guesses</div>
            <button id="hintBtn" class="flex items-center gap-1 text-[10px] md:text-xs font-bold text-indigo-500 hover:text-indigo-700 uppercase p-1 rounded hover:bg-indigo-50 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>
                Need a hint?
            </button>
        </div>

        <!-- Keys -->
        <div id="keyboard" class="flex flex-col gap-1 select-none touch-manipulation pb-1">
            <!-- Row 1 -->
            <div class="flex gap-1 justify-center touch-manipulation">
                <button class="key" data-key="Q">Q</button>
                <button class="key" data-key="W">W</button>
                <button class="key" data-key="E">E</button>
                <button class="key" data-key="R">R</button>
                <button class="key" data-key="T">T</button>
                <button class="key" data-key="Y">Y</button>
                <button class="key" data-key="U">U</button>
                <button class="key" data-key="I">I</button>
                <button class="key" data-key="O">O</button>
                <button class="key" data-key="P">P</button>
            </div>
            <!-- Row 2 -->
            <div class="flex gap-1 justify-center touch-manipulation px-2">
                <button class="key" data-key="A">A</button>
                <button class="key" data-key="S">S</button>
                <button class="key" data-key="D">D</button>
                <button class="key" data-key="F">F</button>
                <button class="key" data-key="G">G</button>
                <button class="key" data-key="H">H</button>
                <button class="key" data-key="J">J</button>
                <button class="key" data-key="K">K</button>
                <button class="key" data-key="L">L</button>
            </div>
            <!-- Row 3 -->
            <div class="flex gap-1 justify-center touch-manipulation">
                <button class="key-wide bg-slate-200 text-slate-900" id="enterKey">ENTR</button>
                <button class="key" data-key="Z">Z</button>
                <button class="key" data-key="X">X</button>
                <button class="key" data-key="C">C</button>
                <button class="key" data-key="V">V</button>
                <button class="key" data-key="B">B</button>
                <button class="key" data-key="N">N</button>
                <button class="key" data-key="M">M</button>
                <button class="key-wide bg-slate-200 text-slate-900" id="backspaceKey">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"/><line x1="18" y1="9" x2="12" y2="15"/><line x1="12" y1="9" x2="18" y2="15"/></svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- EXPANDED VOCABULARY LIST (150+ items) ---
        const RAW_VOCAB = [
            // BASICS & COLOURS
            { word: "NOIR", clue: "Colour: Black", article: "LE" },
            { word: "BLANC", clue: "Colour: White", article: "LE" },
            { word: "ROUGE", clue: "Colour: Red", article: "LE" },
            { word: "BLEU", clue: "Colour: Blue", article: "LE" },
            { word: "VERT", clue: "Colour: Green", article: "LE" },
            { word: "JAUNE", clue: "Colour: Yellow", article: "LE" },
            { word: "GRIS", clue: "Colour: Grey", article: "LE" },
            { word: "ROSE", clue: "Colour: Pink", article: "LE" },
            { word: "MARRON", clue: "Colour: Brown", article: "LE" },
            { word: "ORANGE", clue: "Colour: Orange", article: "L'" },
            { word: "VIOLET", clue: "Colour: Purple", article: "LE" },
            { word: "SOMBRE", clue: "Adjective: Dark", article: "" },
            { word: "CLAIR", clue: "Adjective: Light (colour)", article: "" },

            // FAMILY
            { word: "MERE", display: "MÈRE", clue: "Mother", article: "LA" },
            { word: "PERE", display: "PÈRE", clue: "Father", article: "LE" },
            { word: "SOEUR", display: "SŒUR", clue: "Sister", article: "LA" },
            { word: "FRERE", display: "FRÈRE", clue: "Brother", article: "LE" },
            { word: "TANTE", clue: "Aunt", article: "LA" },
            { word: "ONCLE", clue: "Uncle", article: "L'" },
            { word: "COUSIN", clue: "Cousin (Male)", article: "LE" },
            { word: "COUSINE", clue: "Cousin (Female)", article: "LA" },
            { word: "GRAND-PERE", display: "GRAND-PÈRE", clue: "Grandfather", article: "LE" },
            { word: "GRAND-MERE", display: "GRAND-MÈRE", clue: "Grandmother", article: "LA" },
            { word: "FAMILLE", clue: "Family", article: "LA" },
            { word: "BEBE", display: "BÉBÉ", clue: "Baby", article: "LE" },
            { word: "ENFANT", clue: "Child", article: "L'" },
            { word: "PARENTS", clue: "Parents", article: "LES" },

            // HOME
            { word: "MAISON", clue: "House", article: "LA" },
            { word: "APPARTEMENT", clue: "Apartment / Flat", article: "L'" },
            { word: "JARDIN", clue: "Garden", article: "LE" },
            { word: "CHAMBRE", clue: "Bedroom", article: "LA" },
            { word: "CUISINE", clue: "Kitchen / Cooking", article: "LA" },
            { word: "SALON", clue: "Living room", article: "LE" },
            { word: "DOUCHE", clue: "Shower", article: "LA" },
            { word: "BAIN", clue: "Bath", article: "LE" },
            { word: "LIT", clue: "Bed", article: "LE" },
            { word: "CHAISE", clue: "Chair", article: "LA" },
            { word: "FENETRE", display: "FENÊTRE", clue: "Window", article: "LA" },
            { word: "PORTE", clue: "Door", article: "LA" },
            { word: "TABLE", clue: "Table", article: "LA" },
            { word: "MUR", clue: "Wall", article: "LE" },
            { word: "SOL", clue: "Floor / Ground", article: "LE" },
            { word: "TOIT", clue: "Roof", article: "LE" },
            { word: "ESCALIER", clue: "Stairs", article: "L'" },

            // FOOD & DRINK
            { word: "POMME", clue: "Fruit: Apple", article: "LA" },
            { word: "BANANE", clue: "Fruit: Banana", article: "LA" },
            { word: "POIRE", clue: "Fruit: Pear", article: "LA" },
            { word: "PAIN", clue: "Bread", article: "LE" },
            { word: "EAU", clue: "Water", article: "L'" },
            { word: "LAIT", clue: "Milk", article: "LE" },
            { word: "FRITES", clue: "Chips / Fries", article: "LES" },
            { word: "POULET", clue: "Chicken (Food)", article: "LE" },
            { word: "BOEUF", display: "BŒUF", clue: "Beef", article: "LE" },
            { word: "PORC", clue: "Pork", article: "LE" },
            { word: "GATEAU", display: "GÂTEAU", clue: "Cake", article: "LE" },
            { word: "FROMAGE", clue: "Cheese", article: "LE" },
            { word: "OEUF", display: "ŒUF", clue: "Egg", article: "L'" },
            { word: "LEGUMES", display: "LÉGUMES", clue: "Vegetables", article: "LES" },
            { word: "FRUITS", clue: "Fruits", article: "LES" },
            { word: "PETIT-DEJEUNER", display: "PETIT-DÉJEUNER", clue: "Breakfast", article: "LE" },
            { word: "DEJEUNER", display: "DÉJEUNER", clue: "Lunch", article: "LE" },
            { word: "DINER", display: "DÎNER", clue: "Dinner", article: "LE" },
            { word: "SUCRE", clue: "Sugar", article: "LE" },
            { word: "SEL", clue: "Salt", article: "LE" },
            { word: "BEURRE", clue: "Butter", article: "LE" },
            { word: "JUS", clue: "Juice", article: "LE" },
            { word: "THE", display: "THÉ", clue: "Tea", article: "LE" },
            { word: "CAFE", display: "CAFÉ", clue: "Coffee", article: "LE" },

            // SCHOOL
            { word: "ECOLE", display: "ÉCOLE", clue: "School", article: "L'" },
            { word: "COLLEGE", display: "COLLÈGE", clue: "Secondary School (Middle)", article: "LE" },
            { word: "LYCEE", display: "LYCÉE", clue: "High School / Sixth Form", article: "LE" },
            { word: "STYLO", clue: "Pen", article: "LE" },
            { word: "CRAYON", clue: "Pencil", article: "LE" },
            { word: "GOMME", clue: "Eraser / Rubber", article: "LA" },
            { word: "LIVRE", clue: "Book", article: "LE" },
            { word: "PROFESSEUR", clue: "Teacher", article: "LE" },
            { word: "ELEVE", display: "ÉLÈVE", clue: "Pupil", article: "L'" },
            { word: "DEVOIRS", clue: "Homework", article: "LES" },
            { word: "ANGLAIS", clue: "Subject: English", article: "L'" },
            { word: "FRANCAIS", display: "FRANÇAIS", clue: "Subject: French", article: "LE" },
            { word: "HISTOIRE", clue: "Subject: History", article: "L'" },
            { word: "GEOGRAPHIE", display: "GÉOGRAPHIE", clue: "Subject: Geography", article: "LA" },
            { word: "MATHS", clue: "Subject: Maths", article: "LES" },
            { word: "SCIENCES", clue: "Subject: Science", article: "LES" },
            { word: "DESSIN", clue: "Subject: Art/Drawing", article: "LE" },
            { word: "CAHIER", clue: "Exercise book", article: "LE" },

            // CLOTHES (VETEMENTS)
            { word: "PANTALON", clue: "Trousers", article: "LE" },
            { word: "CHEMISE", clue: "Shirt", article: "LA" },
            { word: "T-SHIRT", clue: "T-shirt", article: "LE" },
            { word: "PULL", clue: "Jumper / Sweater", article: "LE" },
            { word: "ROBE", clue: "Dress", article: "LA" },
            { word: "JUPE", clue: "Skirt", article: "LA" },
            { word: "MANTEAU", clue: "Coat", article: "LE" },
            { word: "CHAPEAU", clue: "Hat", article: "LE" },
            { word: "CHAUSSURES", clue: "Shoes", article: "LES" },
            { word: "CHAUSSETTES", clue: "Socks", article: "LES" },
            { word: "BASKETS", clue: "Trainers / Sneakers", article: "LES" },
            { word: "LUNETTES", clue: "Glasses", article: "LES" },

            // WEATHER (METEO)
            { word: "SOLEIL", clue: "Sun", article: "LE" },
            { word: "PLUIE", clue: "Rain", article: "LA" },
            { word: "NEIGE", clue: "Snow", article: "LA" },
            { word: "VENT", clue: "Wind", article: "LE" },
            { word: "NUAGE", clue: "Cloud", article: "LE" },
            { word: "ORAGE", clue: "Storm", article: "L'" },
            { word: "CHAUD", clue: "Adjective: Hot", article: "" },
            { word: "FROID", clue: "Adjective: Cold", article: "" },
            { word: "BEAU", clue: "Adjective: Beautiful / Fine (weather)", article: "" },
            { word: "MAUVAIS", clue: "Adjective: Bad", article: "" },

            // TRANSPORT & TRAVEL
            { word: "VOITURE", clue: "Car", article: "LA" },
            { word: "TRAIN", clue: "Train", article: "LE" },
            { word: "BUS", clue: "Bus", article: "LE" },
            { word: "VELO", display: "VÉLO", clue: "Bicycle", article: "LE" },
            { word: "AVION", clue: "Plane", article: "L'" },
            { word: "BATEAU", clue: "Boat", article: "LE" },
            { word: "VACANCES", clue: "Holidays", article: "LES" },
            { word: "PLAGE", clue: "Beach", article: "LA" },
            { word: "MER", clue: "Sea", article: "LA" },
            { word: "HOTEL", display: "HÔTEL", clue: "Hotel", article: "L'" },
            { word: "PASSEPORT", clue: "Passport", article: "LE" },
            { word: "BILLET", clue: "Ticket", article: "LE" },
            { word: "VALISE", clue: "Suitcase", article: "LA" },

            // PLACES & DIRECTIONS
            { word: "VILLE", clue: "Town / City", article: "LA" },
            { word: "VILLAGE", clue: "Village", article: "LE" },
            { word: "CAMPAGNE", clue: "Countryside", article: "LA" },
            { word: "MONTAGNE", clue: "Mountain", article: "LA" },
            { word: "NORD", clue: "Direction: North", article: "LE" },
            { word: "SUD", clue: "Direction: South", article: "LE" },
            { word: "EST", clue: "Direction: East", article: "L'" },
            { word: "OUEST", clue: "Direction: West", article: "L'" },
            { word: "GAUCHE", clue: "Direction: Left", article: "A" },
            { word: "DROITE", clue: "Direction: Right", article: "A" },
            { word: "RUE", clue: "Street", article: "LA" },
            { word: "PONT", clue: "Bridge", article: "LE" },
            { word: "EGLISE", display: "ÉGLISE", clue: "Church", article: "L'" },
            { word: "MARCHE", display: "MARCHÉ", clue: "Market", article: "LE" },

            // PROFESSIONS (METIERS)
            { word: "MEDECIN", display: "MÉDECIN", clue: "Doctor", article: "LE" },
            { word: "INFIRMIER", clue: "Nurse (Male)", article: "L'" },
            { word: "DENTISTE", clue: "Dentist", article: "LE" },
            { word: "VETERINAIRE", display: "VÉTÉRINAIRE", clue: "Vet", article: "LE" },
            { word: "POMPIER", clue: "Firefighter", article: "LE" },
            { word: "POLICIER", clue: "Police officer", article: "LE" },
            { word: "ACTEUR", clue: "Actor", article: "L'" },
            { word: "CHANTEUR", clue: "Singer", article: "LE" },
            { word: "CUISINIER", clue: "Chef / Cook", article: "LE" },
            { word: "FERMIER", clue: "Farmer", article: "LE" },

            // ACTIVITIES
            { word: "FOOTBALL", clue: "Sport: Football", article: "LE" },
            { word: "TENNIS", clue: "Sport: Tennis", article: "LE" },
            { word: "RUGBY", clue: "Sport: Rugby", article: "LE" },
            { word: "NATATION", clue: "Swimming", article: "LA" },
            { word: "CINEMA", display: "CINÉMA", clue: "Cinema", article: "LE" },
            { word: "MUSIQUE", clue: "Music", article: "LA" },
            { word: "LECTURE", clue: "Reading", article: "LA" },
            { word: "JEUX-VIDEO", display: "JEUX-VIDÉO", clue: "Video Games", article: "LES" },
            { word: "SHOPPING", clue: "Going to the shops", article: "LE" },
            { word: "DANSE", clue: "Dance", article: "LA" },
            { word: "VOYAGE", clue: "Trip / Journey", article: "LE" },

            // BODY & HEALTH
            { word: "TETE", display: "TÊTE", clue: "Head", article: "LA" },
            { word: "BRAS", clue: "Arm", article: "LE" },
            { word: "JAMBE", clue: "Leg", article: "LA" },
            { word: "MAIN", clue: "Hand", article: "LA" },
            { word: "PIED", clue: "Foot", article: "LE" },
            { word: "YEUX", clue: "Eyes", article: "LES" },
            { word: "NEZ", clue: "Nose", article: "LE" },
            { word: "BOUCHE", clue: "Mouth", article: "LA" },
            { word: "OREILLE", clue: "Ear", article: "L'" },
            { word: "MALADE", clue: "Ill / Sick", article: "" },
            { word: "FATIGUE", display: "FATIGUÉ", clue: "Tired", article: "" },
            { word: "HOPITAL", display: "HÔPITAL", clue: "Hospital", article: "L'" },

            // ANIMALS
            { word: "CHIEN", clue: "Dog", article: "LE" },
            { word: "CHAT", clue: "Cat", article: "LE" },
            { word: "OISEAU", clue: "Bird", article: "L'" },
            { word: "POISSON", clue: "Fish", article: "LE" },
            { word: "CHEVAL", clue: "Horse", article: "LE" },
            { word: "LAPIN", clue: "Rabbit", article: "LE" },
            { word: "SOURIS", clue: "Mouse", article: "LA" },
            { word: "COCHON", clue: "Pig", article: "LE" },
            { word: "VACHE", clue: "Cow", article: "LA" },
            { word: "MOUTON", clue: "Sheep", article: "LE" },

            // PHRASES & MISC
            { word: "J'AI FAIM", clue: "Phrase: 'I am hungry'", article: "" },
            { word: "J'AI SOIF", clue: "Phrase: 'I am thirsty'", article: "" },
            { word: "IL Y A", clue: "Phrase: 'There is' / 'There are'", article: "" },
            { word: "C'EST", clue: "Phrase: 'It is'", article: "" },
            { word: "S'IL TE PLAIT", display: "S'IL TE PLAÎT", clue: "Phrase: 'Please' (informal)", article: "" },
            { word: "MERCI", clue: "Thank you", article: "" },
            { word: "BONJOUR", clue: "Hello", article: "" },
            { word: "SALUT", clue: "Hi / Bye (Informal)", article: "" },
            { word: "AU REVOIR", clue: "Goodbye", article: "" },
            { word: "A BIENTOT", display: "À BIENTÔT", clue: "See you soon", article: "" },
            { word: "JOYEUX NOEL", display: "JOYEUX NOËL", clue: "Merry Christmas", article: "" },
            { word: "BONNE NUIT", clue: "Good night", article: "" },
            { word: "OUI", clue: "Yes", article: "" },
            { word: "NON", clue: "No", article: "" }
        ];

        // --- GAME LOGIC ---

        const MAX_GUESSES = 6;
        let targetWordObj = null;
        let guesses = [];
        let currentInput = ""; // Letters only
        let state = "playing"; // playing, won, lost
        let lastSubmittedRowIndex = -1; // To control which row is animating

        // DOM Elements
        const gridContainer = document.getElementById('gridContainer');
        const clueText = document.getElementById('clueText');
        const lengthBadge = document.getElementById('lengthBadge');
        const toastEl = document.getElementById('toast');
        const modal = document.getElementById('resultModal');
        const guessCounter = document.getElementById('guessCounter');

        // Initialize
        function initGame() {
            // Clean vocab list to ensure consistency
            const processedVocab = RAW_VOCAB.map(item => {
                let combinedWord = item.word;
                let combinedDisplay = item.display || item.word;

                // PREPEND ARTICLE TO GAME WORDS if present
                if (item.article) {
                    if (item.article.endsWith("'")) {
                        // e.g. L'ECOLE
                        combinedWord = item.article + item.word;
                        combinedDisplay = item.article + (item.display || item.word);
                    } else {
                        // e.g. LA MER
                        combinedWord = item.article + " " + item.word;
                        combinedDisplay = item.article + " " + (item.display || item.word);
                    }
                }

                const clean = combinedWord.replace(/[^A-Z]/g, ''); // Removes spaces and '
                
                return { 
                    ...item, 
                    word: combinedWord, // Updates the grid template (includes article)
                    cleanWord: clean,   // Updates the typing logic (includes article)
                    fullDisplay: combinedDisplay // Updates the result text
                };
            });

            targetWordObj = processedVocab[Math.floor(Math.random() * processedVocab.length)];
            guesses = [];
            currentInput = "";
            state = "playing";
            lastSubmittedRowIndex = -1;

            // Reset UI
            clueText.textContent = `"${targetWordObj.clue}"`;
            lengthBadge.textContent = `${targetWordObj.cleanWord.length} Letters`;
            guessCounter.textContent = `0 / ${MAX_GUESSES} Guesses`;
            modal.classList.add('hidden');
            
            resetKeyboard();
            renderGrid();
        }

        // Render the Grid
        function renderGrid() {
            gridContainer.innerHTML = '';
            
            // 1. Render submitted guesses
            guesses.forEach((guess, index) => {
                const shouldAnimate = index === lastSubmittedRowIndex;
                gridContainer.appendChild(createRow(guess, 'submitted', shouldAnimate));
            });

            // 2. Render current active row
            if (state === 'playing' && guesses.length < MAX_GUESSES) {
                gridContainer.appendChild(createRow(currentInput, 'active', false));
            }

            // 3. Render empty rows
            const rowsRemaining = MAX_GUESSES - guesses.length - (state === 'playing' ? 1 : 0);
            for (let i = 0; i < rowsRemaining; i++) {
                gridContainer.appendChild(createRow('', 'empty', false));
            }
            
            // Auto scroll to bottom
            gridContainer.scrollTop = gridContainer.scrollHeight;
        }

        function createRow(guessContent, rowStatus, shouldAnimate) {
            const rowDiv = document.createElement('div');
            rowDiv.className = "flex justify-center items-center gap-1 mb-2 w-full max-w-full";

            // Visual Template logic (Punctuation handling)
            const templateChars = targetWordObj.word.toUpperCase().split('');
            let cleanIndex = 0;

            // Logic for colors (if submitted)
            let letterColors = [];
            if (rowStatus === 'submitted') {
                letterColors = calculateColors(guessContent, targetWordObj.cleanWord);
            }

            templateChars.forEach((char, i) => {
                // CASE A: Space
                if (char === ' ') {
                    const space = document.createElement('div');
                    space.className = "w-2 md:w-4 flex-shrink-0";
                    rowDiv.appendChild(space);
                    return;
                }

                // CASE B: Punctuation
                if (!/[A-Z]/.test(char)) {
                    const puncBox = document.createElement('div');
                    puncBox.className = "w-8 h-10 md:w-12 md:h-14 border border-slate-300 bg-slate-200 text-slate-500 flex items-center justify-center text-lg md:text-2xl font-bold rounded flex-shrink-0 select-none";
                    puncBox.textContent = char;
                    rowDiv.appendChild(puncBox);
                    return;
                }

                // CASE C: Letter Box
                const box = document.createElement('div');
                const letter = rowStatus === 'submitted' || rowStatus === 'active' ? (guessContent[cleanIndex] || '') : '';
                
                let baseClass = "w-8 h-10 md:w-12 md:h-14 border-2 flex items-center justify-center text-xl md:text-3xl font-bold rounded uppercase flex-shrink-0 transition-all duration-500 select-none";
                
                if (rowStatus === 'submitted') {
                    const status = letterColors[cleanIndex];
                    box.className = `${baseClass} text-white`;
                    
                    if (shouldAnimate) {
                        box.classList.add('flip-in');
                        // Stagger animation
                        box.style.animationDelay = `${cleanIndex * 100}ms`;
                    }
                    
                    if (status === 'correct') box.classList.add('bg-green-500', 'border-green-600');
                    else if (status === 'present') box.classList.add('bg-yellow-500', 'border-yellow-600');
                    else box.classList.add('bg-slate-500', 'border-slate-600');
                    
                } else if (rowStatus === 'active') {
                    if (letter) {
                        box.className = `${baseClass} border-slate-400 bg-white text-slate-900 border-b-4 animate-[pop_0.1s]`; 
                    } else {
                        box.className = `${baseClass} border-slate-200 bg-white text-slate-900`;
                    }
                } else {
                    box.className = `${baseClass} border-slate-200 bg-slate-50 opacity-50`;
                }

                box.textContent = letter;
                rowDiv.appendChild(box);
                cleanIndex++;
            });

            return rowDiv;
        }

        // Logic: Calculate Colors (Double Pass)
        function calculateColors(guess, target) {
            const res = Array(target.length).fill('absent');
            const targetArr = target.split('');
            const guessArr = guess.split('');
            const targetFreq = {};

            // Frequency map
            targetArr.forEach(c => targetFreq[c] = (targetFreq[c] || 0) + 1);

            // Pass 1: Green
            for (let i = 0; i < target.length; i++) {
                if (guessArr[i] === targetArr[i]) {
                    res[i] = 'correct';
                    targetFreq[guessArr[i]]--;
                    guessArr[i] = null;
                    targetArr[i] = null;
                }
            }

            // Pass 2: Yellow
            for (let i = 0; i < target.length; i++) {
                if (guessArr[i] !== null) {
                    if (targetFreq[guessArr[i]] > 0) {
                        res[i] = 'present';
                        targetFreq[guessArr[i]]--;
                    }
                }
            }
            return res;
        }

        // --- INPUT HANDLING ---

        function handleInput(key) {
            if (state !== 'playing') return;
            // Interrupt any previous animations if typing occurs
            lastSubmittedRowIndex = -1;
            
            if (currentInput.length < targetWordObj.cleanWord.length) {
                currentInput += key;
                renderGrid();
            }
        }

        function handleDelete() {
            if (state !== 'playing') return;
            lastSubmittedRowIndex = -1;
            currentInput = currentInput.slice(0, -1);
            renderGrid();
        }

        function handleSubmit() {
            if (state !== 'playing') return;

            if (currentInput.length !== targetWordObj.cleanWord.length) {
                showToast("Too short!");
                // Add shake effect to active row
                const rows = gridContainer.children;
                const activeRow = rows[guesses.length];
                activeRow.classList.add('shake');
                setTimeout(() => activeRow.classList.remove('shake'), 500);
                return;
            }

            // Commit guess
            guesses.push(currentInput);
            guessCounter.textContent = `${guesses.length} / ${MAX_GUESSES} Guesses`;
            
            // Mark this row for animation
            lastSubmittedRowIndex = guesses.length - 1;
            
            // Update Keyboard Colors
            updateKeyboard(currentInput);

            // Check Win/Loss
            if (currentInput === targetWordObj.cleanWord) {
                state = 'won';
                renderGrid();
                setTimeout(() => showResult(true), 1500); // Wait for animations
            } else if (guesses.length >= MAX_GUESSES) {
                state = 'lost';
                renderGrid();
                setTimeout(() => showResult(false), 1500);
            } else {
                currentInput = "";
                renderGrid();
                
                // Clear the animation flag after animation duration so typing doesn't re-trigger it
                setTimeout(() => {
                    lastSubmittedRowIndex = -1;
                }, 2000);
            }
        }

        function updateKeyboard(guess) {
            const colors = calculateColors(guess, targetWordObj.cleanWord);
            guess.split('').forEach((char, i) => {
                const keyBtn = document.querySelector(`button[data-key="${char}"]`);
                if (!keyBtn) return;

                const status = colors[i];
                // Priority: Green > Yellow > Grey
                // We check current class to ensures we don't downgrade a green to yellow
                if (status === 'correct') {
                    keyBtn.className = "key bg-green-500 text-white border-green-600";
                } else if (status === 'present' && !keyBtn.classList.contains('bg-green-500')) {
                    keyBtn.className = "key bg-yellow-500 text-white border-yellow-600";
                } else if (status === 'absent' && !keyBtn.classList.contains('bg-green-500') && !keyBtn.classList.contains('bg-yellow-500')) {
                    keyBtn.className = "key bg-slate-500 text-white border-slate-600";
                }
            });
        }

        function resetKeyboard() {
            document.querySelectorAll('.key').forEach(btn => {
                btn.className = "key bg-slate-200 hover:bg-slate-300 text-slate-900 border-slate-300";
            });
        }

        // --- UI UTILS ---

        function showToast(msg) {
            toastEl.textContent = msg;
            toastEl.classList.remove('hidden');
            toastEl.classList.add('opacity-100');
            setTimeout(() => {
                toastEl.classList.remove('opacity-100');
                toastEl.classList.add('opacity-0');
                setTimeout(() => toastEl.classList.add('hidden'), 300);
            }, 1000);
        }

        function showResult(won) {
            modal.classList.remove('hidden');
            const title = document.getElementById('resultTitle');
            const word = document.getElementById('resultWord');
            const icon = document.getElementById('resultIcon');

            if (won) {
                title.textContent = "C'est Correct!";
                title.className = "text-2xl md:text-3xl font-bold text-green-600 mb-2";
                icon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#ca8a04" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>`;
            } else {
                title.textContent = "Dommage...";
                title.className = "text-2xl md:text-3xl font-bold text-red-600 mb-2";
                icon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>`;
            }
            word.textContent = targetWordObj.fullDisplay;
        }

        // --- EVENT LISTENERS ---

        document.getElementById('keyboard').addEventListener('click', (e) => {
            const btn = e.target.closest('button');
            if (!btn) return;

            if (btn.id === 'enterKey') handleSubmit();
            else if (btn.id === 'backspaceKey') handleDelete();
            else if (btn.dataset.key) handleInput(btn.dataset.key);
        });

        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey || e.altKey) return;
            const key = e.key.toUpperCase();
            if (key === 'ENTER') handleSubmit();
            else if (key === 'BACKSPACE') handleDelete();
            else if (/^[A-Z]$/.test(key) && key.length === 1) handleInput(key);
        });

        document.getElementById('restartBtn').addEventListener('click', initGame);
        document.getElementById('modalRestartBtn').addEventListener('click', initGame);

        document.getElementById('hintBtn').addEventListener('click', () => {
            if (state !== 'playing') return;
            const target = targetWordObj.cleanWord;
            const idx = currentInput.length;
            if (idx < target.length) {
                handleInput(target[idx]);
            }
        });

        // Styles for dynamic buttons created in HTML
        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            .key { 
                height: 3rem; /* Reduced from 3.5rem */
                flex: 1; 
                font-weight: bold; 
                border-radius: 0.25rem; 
                font-size: 0.875rem;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.1s;
                border-bottom-width: 2px;
                touch-action: manipulation;
            }
            .key:active { transform: scale(0.95); }
            .key-wide { 
                height: 3rem; /* Reduced from 3.5rem */
                flex: 1.5; 
                font-weight: bold; 
                border-radius: 0.25rem; 
                font-size: 0.75rem; 
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.1s;
                border-bottom-width: 2px;
                border-color: #cbd5e1;
                touch-action: manipulation;
            }
            .key-wide:active { transform: scale(0.95); }

            /* Taller screens */
            @media (min-height: 600px) {
                 .key, .key-wide { height: 3.5rem; }
            }

            /* Tablet/Desktop */
            @media (min-width: 768px) {
                .key, .key-wide { height: 4rem; font-size: 1rem; }
            }
            
            /* Very short screens (landscape mobile) */
            @media (max-height: 480px) {
                .key, .key-wide { height: 2.2rem; font-size: 0.75rem; }
            }
        `;
        document.head.appendChild(styleSheet);

        // Start Game
        initGame();

    </script>
</body>
</html>